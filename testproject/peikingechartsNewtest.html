<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
</head>
<body style="background: #141414">
<div class="chart-line-test" id="echarts" style="width:100%;height: 300px; margin: 0 auto"></div>

<script src="jquery.js"></script>
<script src="echarts.js"></script>
<!--<script src="../public/js/castheme.js"></script>-->
<script>
  var showTime = 5000;
  var queryString = {
    systemLoad1:"http://192.168.1.11:8086/query?q=select+load1+from+%22system%22+where+host+%3D+'hpc-mix3-node1.bjIDC.datopia.cn'+AND+time+%3E%3D+now()+-+30m&db=telegraf",
    systemLoad5:"http://192.168.1.11:8086/query?q=select+load5+from+%22system%22+where+host+%3D+'hpc-mix3-node1.bjIDC.datopia.cn'+AND+time+%3E%3D+now()+-+30m&db=telegraf",
    systemLoad15:"http://192.168.1.11:8086/query?q=select+load15+from+%22system%22+where+host+%3D+'hpc-mix3-node1.bjIDC.datopia.cn'+AND+time+%3E%3D+now()+-+30m&db=telegraf"
  };

  /*渲染函数*/
  function makeMeter(divID,legend,time,dataArray) {
    var myCharts = echarts.init(document.getElementById(divID));
    var option = {
      title: {
        text: ''
      },
      tooltip: {
        trigger: 'axis',
      },
      legend: {
        data: legend,
        textStyle: {
          color:'#fff'
        }
      },
      toolbox: {
        feature: {
          saveAsImage: {}
        }
      },
      textStyle: {
        color: '#fff'
      },
//      background:'#141414',
      color:['#7eb26d','#eab839','#6ed0e0'],
      grid: {
        left: '3%',
        right: '4%',
        bottom: '3%',
        containLabel: true
      },
      xAxis: {
        type: 'category',
        boundaryGap: false,
        data: time,
        splitLine: false,
      },

      yAxis: [
        {
          type: 'value'
        }
      ],
      series:function () {
        var serie = [];
        var item = [];
        for (var i = 0; i < dataArray.length; i++) {
          item = {
            data: dataArray[i],
            name: legend[i],
            type: 'line',
            animation: false,
            areaStyle:{
              normal:{
                color:'#7eb26d',
                opacity:0.1
              }
            }
          };
          serie.push(item);
        }
        return serie;
      }()
    };
    myCharts.setOption(option);
  };

  /*查询函数*/
  function queryToData(divID,queryInfo){
    var dataArray = [];
    var time = [];
    var legend =[];
    for (var idx in queryInfo){
      $.ajax({
        url:queryInfo[idx],
        type:"GET",
        async:false,
        success:function (Data) {
          var singledata = [];
          var meterData = Data.results[0].series[0];
          var values = meterData.values;
          time = [];
          for (var inx in values) {
            time.push(values[inx][0].slice(11, 16));
            singledata.push(values[inx][1]);
          }
          dataArray.push(singledata);
          legend.push(meterData.columns[1])
        }
      })
    };
    makeMeter(divID,legend,time,dataArray);
  };
  function makeLine(divID,queryInfo,refreshTime) {
    /*时间刷新*/
    //queryToData(divID,queryInfo)
   setInterval(
      function () {
        queryToData(divID,queryInfo)
        console.log("11111")
      },refreshTime);
  };
  makeLine("echarts",queryString,showTime)
</script>
</body>
</html>